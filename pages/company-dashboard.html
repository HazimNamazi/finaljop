<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¢ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙƒØ§Øª - Ù…Ù†ØµØ© Ø§Ù„ØªÙˆØ¸ÙŠÙ</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 10px;
    }

    .dashboard-container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.3);
      padding: 30px;
      width: 100%;
      max-width: 900px;
    }

    h1 {
      text-align: center;
      color: #ffd369;
      font-size: 28px;
      margin-bottom: 10px;
    }

    h3 {
      color: #fff;
      text-align: center;
      margin-bottom: 25px;
    }

    button {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 18px;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: scale(1.03);
      background: linear-gradient(135deg, #0056b3, #003d80);
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      font-size: 14px;
      resize: none;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.25);
    }

    .filter-box {
      text-align: center;
      margin-bottom: 20px;
    }

    select {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 8px;
    }

    .btn-accept {
      background:#28a745;
      color:white;
      padding:8px 15px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin-left:10px;
    }

    .btn-reject {
      background:#dc3545;
      color:white;
      padding:8px 15px;
      border:none;
      border-radius:6px;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <h1>ğŸ¢ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙƒØ§Øª</h1>
    <h3 id="welcome"></h3>

    <div style="text-align:center;">
      <button id="addJobBtn">â• Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <section id="jobForm" style="display:none; margin-top: 20px;">
      <h3>Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
      <input id="jobTitle" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required>
      <textarea id="jobDescription" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required></textarea>
      <input id="jobLocation" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" required>
      <input id="jobSalary" placeholder="Ø§Ù„Ø±Ø§ØªØ¨" required>

      <div style="text-align:center;">
        <button id="submitJobBtn">ğŸ“¢ Ù†Ø´Ø± Ø§Ù„ÙˆØ¸ÙŠÙØ©</button>
      </div>
    </section>

    <hr>

    <h3>ğŸ“‹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h3>
    <div id="jobsList"></div>

    <hr>

    <h3>ğŸ“¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h3>
    <div class="filter-box">
      <label for="filterSelect">ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</label>
      <select id="filterSelect">
        <option value="all">ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</option>
        <option value="pending">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</option>
        <option value="accepted">Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</option>
        <option value="rejected">Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</option>
      </select>
    </div>

    <div id="applicationsList"></div>

<script>
async function loadApplications() {
  const res = await fetch("/.netlify/functions/get-company-applications?company_id=" + userData.id);
  const applications = await res.json();
  displayApplications(applications);
}

function displayApplications(apps) {
  applicationsList.innerHTML = apps.map(app => `
    <div class="card">
      <h4>ğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨: ${app.applicant_name}</h4>
      <p>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${app.email}</p>
      <p>ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©: ${app.job_title}</p>
      <p>ğŸ“„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: <strong>${app.status}</strong></p>
      
      ${app.cv_url ? `<a href="${app.cv_url}" target="_blank" style="color:#0af;font-weight:bold;">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</a>` : ''}

      <br><br>

      ${app.status === "Ø¬Ø¯ÙŠØ¯" ? `
        <button onclick="acceptApplication(${app.id})">âœ”ï¸ Ù‚Ø¨ÙˆÙ„</button>
        <button onclick="rejectApplication(${app.id})">âŒ Ø±ÙØ¶</button>
      ` : ''}

      ${app.status === "Ù…Ù‚Ø¨ÙˆÙ„" ? `
        <div>
          <h4>ğŸ“… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ¹Ø¯ Ù…Ù‚Ø§Ø¨Ù„Ø©</h4>
          <input type="datetime-local" id="date-${app.id}">
          <button onclick="saveInterview(${app.id})">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
        </div>
      ` : ''}
    </div>
  `).join("");
}

async function acceptApplication(id) {
  await updateStatus(id, "Ù…Ù‚Ø¨ÙˆÙ„");
}

async function rejectApplication(id) {
  await updateStatus(id, "Ù…Ø±ÙÙˆØ¶");
}

async function updateStatus(appId, newStatus) {
  const res = await fetch("/.netlify/functions/update-application-status", {
    method: "POST",
    body: JSON.stringify({ id: appId, status: newStatus }),
  });
  loadApplications();
}

async function saveInterview(appId) {
  const interview_date = document.getElementById(`date-${appId}`).value;

  const res = await fetch("/.netlify/functions/set-interview", {
    method: "POST",
    body: JSON.stringify({
      application_id: appId,
      interview_date
    })
  });

  alert("âœ”ï¸ ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©");
  loadApplications();
}
</script>

</body>
</html>
