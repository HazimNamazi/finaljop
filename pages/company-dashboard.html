<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¢ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙƒØ§Øª - Ù…Ù†ØµØ© Ø§Ù„ØªÙˆØ¸ÙŠÙ</title>

  <!-- âœ… Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 10px;
    }

    .dashboard-container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.3);
      padding: 30px;
      width: 100%;
      max-width: 900px;
    }

    h1 {
      text-align: center;
      color: #ffd369;
      font-size: 28px;
      margin-bottom: 10px;
    }

    h3 {
      color: #fff;
      text-align: center;
      margin-bottom: 25px;
    }

    button {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 18px;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: scale(1.03);
      background: linear-gradient(135deg, #0056b3, #003d80);
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      font-size: 14px;
      resize: none;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.25);
    }

    hr {
      border: 0;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      margin: 40px 0;
    }

    .filter-box {
      text-align: center;
      margin-bottom: 20px;
    }

    select {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 8px;
    }

    @media (max-width: 600px) {
      .dashboard-container {
        width: 95%;
        padding: 20px;
      }
      h1 { font-size: 22px; }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <h1>ğŸ¢ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙƒØ§Øª</h1>
    <h3 id="welcome"></h3>

    <!-- ğŸŒŸ Ø²Ø± Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© -->
    <div style="text-align:center;">
      <button id="addJobBtn">â• Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <!-- ğŸ“‹ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© -->
    <section id="jobForm" style="display:none; margin-top: 20px;">
      <h3>Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
      <input id="jobTitle" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required>
      <textarea id="jobDescription" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required></textarea>
      <input id="jobLocation" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" required>
      <input id="jobSalary" placeholder="Ø§Ù„Ø±Ø§ØªØ¨" required>
      <div style="text-align:center;">
        <button id="submitJobBtn">ğŸ“¢ Ù†Ø´Ø± Ø§Ù„ÙˆØ¸ÙŠÙØ©</button>
      </div>
    </section>

    <hr>

    <!-- ğŸ’¼ Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù -->
    <h3>ğŸ“‹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h3>
    <div id="jobsList"></div>

    <hr>

    <!-- ğŸ“¨ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <h3>ğŸ“¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h3>
    <div class="filter-box">
      <label for="filterSelect">ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</label>
      <select id="filterSelect">
        <option value="all">ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</option>
        <option value="Ø¬Ø¯ÙŠØ¯">Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</option>
        <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©</option>
        <option value="Ù…Ø±ÙÙˆØ¶">Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©</option>
      </select>
    </div>

    <div id="applicationsList"></div>
  </div>

  <!-- âœ… JavaScript -->
  <script>
    const userData = JSON.parse(localStorage.getItem("user"));
    if (!userData || userData.user_type !== "company") {
      alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ´Ø±ÙƒØ© Ø£ÙˆÙ„Ø§Ù‹!");
      window.location.href = "../pages/login.html";
    }

    document.getElementById("welcome").textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ${userData?.full_name || "Ø´Ø±ÙƒØ©"} ğŸ‘‹`;

    const addJobBtn = document.getElementById("addJobBtn");
    const jobForm = document.getElementById("jobForm");
    const submitJobBtn = document.getElementById("submitJobBtn");
    const jobsList = document.getElementById("jobsList");
    const filterSelect = document.getElementById("filterSelect");
    const applicationsList = document.getElementById("applicationsList");

    addJobBtn.addEventListener("click", () => {
      jobForm.style.display = jobForm.style.display === "none" ? "block" : "none";
    });

    submitJobBtn.addEventListener("click", async () => {
      const job_title = document.getElementById("jobTitle").value.trim();
const job_description = document.getElementById("jobDescription").value.trim();
const location = document.getElementById("jobLocation").value.trim();
const salary_range = document.getElementById("jobSalary").value.trim();
const company_name = userData.full_name; // Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
const job_type = "Full-time"; // Ø£Ùˆ Ø£Ø¶Ù Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù„Ùˆ Ø­Ø§Ø¨


      if (!job_title || !job_description || !location || !salary_range) {
        alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±");
        return;
      }

      try {
        const res = await fetch("/.netlify/functions/add-job", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
  job_title,
  job_description,
  location,
  salary_range,
  company_id: userData.id,
  company_name,
  job_type
}),

        });

        const data = await res.json();
        if (res.ok) {
          alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø¬Ø§Ø­!");
          jobForm.style.display = "none";
          loadJobs();
        } else {
          alert("âŒ ÙØ´Ù„ Ù†Ø´Ø± Ø§Ù„ÙˆØ¸ÙŠÙØ©: " + data.message);
        }
      } catch (error) {
        alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
        console.error(error);
      }
    });

    async function loadJobs() {
      try {
        const res = await fetch("/.netlify/functions/get-company-jobs?company_id=" + userData.id);
        const jobs = await res.json();

        jobsList.innerHTML = jobs.length
          ? jobs.map(job => `
              <div class="card">
                <h4>${job.job_title}</h4>
                <p>${job.job_description}</p>
                <p>ğŸ“ ${job.location} | ğŸ’° ${job.salary_range}</p>
              </div>
            `).join("")
          : "<p>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ù…Ù†Ø´ÙˆØ±Ø© Ø¨Ø¹Ø¯.</p>";
      } catch (err) {
        jobsList.innerHTML = "<p>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù.</p>";
      }
    }

    async function loadApplications() {
      try {
        const res = await fetch("/.netlify/functions/get-company-applications?company_id=" + userData.id);
        const applications = await res.json();
        displayApplications(applications);
      } catch (err) {
        applicationsList.innerHTML = "<p>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</p>";
      }
    }

    function displayApplications(applications) {
      const selectedFilter = filterSelect.value;
      const filtered = applications.filter(app => selectedFilter === "all" || app.status === selectedFilter);

      applicationsList.innerHTML = filtered.length
        ? filtered.map(app => `
            <div class="card">
              <h4>${app.applicant_name}</h4>
              <p>${app.job_title}</p>
              <p>ğŸ“§ ${app.email}</p>
              <p>ğŸ“„ Ø§Ù„Ø­Ø§Ù„Ø©: ${app.status}</p>
              <button onclick="updateStatus(${app.id}, 'Ù…Ù‚Ø¨ÙˆÙ„')">âœ… Ù‚Ø¨ÙˆÙ„</button>
              <button onclick="updateStatus(${app.id}, 'Ù…Ø±ÙÙˆØ¶')">âŒ Ø±ÙØ¶</button>
            </div>
          `).join("")
        : "<p>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.</p>";
    }

    async function updateStatus(appId, newStatus) {
      try {
        const res = await fetch("/.netlify/functions/update-application-status", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id: appId, status: newStatus }),
        });

        const data = await res.json();
        if (res.ok) {
          alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ "${newStatus}"`);
          loadApplications();
        } else {
          alert("âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + data.message);
        }
      } catch {
        alert("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
      }
    }

    window.onload = () => {
      loadJobs();
      loadApplications();
    };

    filterSelect.addEventListener("change", () => loadApplications());
  </script>
</body>
</html>
