<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“˜ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´ - Ø§Ù„Ø£Ø¯Ù…Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f9;
    }
    .navbar {
      background: #001f3f;
      color: #fff;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .navbar h2 { margin: 0; }
    .navbar a {
      color: #ffd369;
      text-decoration: none;
      margin-left: 25px;
      font-weight: bold;
    }
    .navbar a:hover { color: #fff; }
    .logout-btn {
      background: #dc3545;
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .container {
      padding: 30px;
      max-width: 1100px;
      margin: auto;
    }
    .box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-family: 'Tajawal';
    }
    button {
      padding: 10px 20px;
      background: #28a745;
      color: #fff;
      border:none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { opacity: 0.9; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #00509d;
      color: #fff;
    }
    .students-btn {
      background: #17a2b8;
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
    }
    .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="navbar">
  <h2>ğŸ“˜ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´</h2>
  <div>
    <a href="admin-dashboard.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="admin-workshops.html">ğŸ“˜ Ø§Ù„ÙˆØ±Ø´</a>
    <a href="admin-students.html">ğŸ‘¨â€ğŸ“ Ø§Ù„Ø·Ù„Ø§Ø¨</a>
    <a href="admin-companies.html">ğŸ¢ Ø§Ù„Ø´Ø±ÙƒØ§Øª</a>
    <a href="admin-jobs.html">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a>
  </div>
  <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="container">

  <div class="box">
    <h3>â• Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ø´Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ø´Ø©">
    <textarea id="desc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
    <input id="date" type="date">
    <input id="time" type="time">
    <input id="locationInput" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <input id="link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ±Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <button onclick="createWorkshop()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ±Ø´Ø©</button>
  </div>

  <div class="box">
    <h3>ğŸ“š Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ±Ø´</h3>
    <table id="workshopsTable"></table>
  </div>

</div>

<script>
const admin = JSON.parse(localStorage.getItem("user"));
const admin_id = admin?.id;

if (!admin || admin.user_type !== "admin") {
  alert("âŒ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„");
  window.location.href = "login.html";
}

function logout() {
  localStorage.removeItem("user");
  window.location.href = "login.html";
}

/* âœ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ØµØ­Ø­Ø© */
async function createWorkshop() {
  const titleInput = document.getElementById("title");
  const descInput = document.getElementById("desc");
  const dateInput = document.getElementById("date");
  const timeInput = document.getElementById("time");
  const locationInput = document.getElementById("locationInput");
  const linkInput = document.getElementById("link");

  const data = {
    admin_id,
    title: titleInput.value.trim(),
    description: descInput.value.trim(),
    date: dateInput.value,
    time: timeInput.value,
    location: locationInput.value.trim(),
    link: linkInput.value.trim()
  };

  if (!data.title || !data.date) {
    alert("âš ï¸ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ø´Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø·Ù„ÙˆØ¨Ø§Ù†");
    return;
  }

  const res = await fetch("/.netlify/functions/add-workshop", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  if (!res.ok) {
    alert("âŒ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ±Ø´Ø©");
    return;
  }

  alert("âœ”ï¸ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ±Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­");

  titleInput.value = "";
  descInput.value = "";
  dateInput.value = "";
  timeInput.value = "";
  locationInput.value = "";
  linkInput.value = "";

  loadWorkshops();
}

async function loadWorkshops() {
  const res = await fetch("/.netlify/functions/get-workshops");
  const workshops = await res.json();

  let html = `
    <tr>
      <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
      <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
      <th>Ø§Ù„ÙˆÙ‚Øª</th>
      <th>Ø§Ù„Ø·Ù„Ø§Ø¨</th>
      <th>Ø­Ø°Ù</th>
    </tr>
  `;

  workshops.forEach(w => {
    html += `
      <tr>
        <td>${w.title}</td>
        <td>${w.date}</td>
        <td>${w.time}</td>
        <td>
          <a class="students-btn" href="admin-workshop-students.html?id=${w.id}">
            ğŸ‘¤ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨
          </a>
        </td>
        <td>
          <button class="delete-btn" onclick="deleteWorkshop(${w.id})">ğŸ—‘ Ø­Ø°Ù</button>
        </td>
      </tr>
    `;
  });

  document.getElementById("workshopsTable").innerHTML = html;
}

async function deleteWorkshop(id) {
  if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ø´Ø©ØŸ")) return;

  await fetch("/.netlify/functions/delete-workshop?id=" + id);
  alert("ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ±Ø´Ø©");
  loadWorkshops();
}

loadWorkshops();
</script>

</body>
</html>
