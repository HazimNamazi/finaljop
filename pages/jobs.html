<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-text="page_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%);
      color: white;
      margin: 0;
      padding: 0;
    }

    header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 14px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo { font-weight: 700; color: #ffd369; font-size: 20px; }

    .language-btn {
      cursor: pointer;
      background: none;
      border: 1px solid #ffd369;
      padding: 6px 12px;
      color: #ffd369;
      border-radius: 6px;
      font-size: 13px;
      transition: 0.3s;
    }

    .language-btn:hover {
      background: #ffd369;
      color: #001f3f;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      align-items: center;
      margin: 0;
    }

    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }

    nav a:hover { color: #ffd369; }

    .username {
      color: #ffd369;
      font-weight: bold;
    }

    .logout-btn {
      background: #ff4f4f;
      color: white;
      border-radius: 6px;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    .jobs-container {
      max-width: 900px;
      margin: 60px auto;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(8px);
      padding: 30px;
      border-radius: 16px;
    }

    .job-card {
      background: rgba(255,255,255,0.15);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .job-title { font-size: 20px; font-weight: 700; color: #fff; }
    .company-name { color: #ffd369; font-weight: 600; }

    .apply-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 10px;
      transition: 0.3s;
    }

    .apply-btn:hover { background: #005ecb; }
    .disabled-btn {
      background: #777;
      cursor: not-allowed;
    }
  </style>
</head>

<body>

<header>
  <div class="logo" data-text="header_title">ğŸ’¼ Career Building for JU Students</div>

  <nav>
    <ul id="menu"></ul>
  </nav>

  <button class="language-btn" id="langToggle">EN</button>
</header>

<section class="jobs-container">
  <h2 data-text="jobs_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="jobsList" data-text="loading">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>
</section>

<script>
/* ============================================
      ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø© AR / EN
============================================ */
const translations = {
  ar: {
    page_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
    header_title: "ğŸ’¼ Career Building for JU Students",
    jobs_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
    loading: "â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...",
    no_jobs: "ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù",
    apply: "ğŸ“„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©",
    contact: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
    about: "Ù…Ù† Ù†Ø­Ù†ØŸ",
    logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",
    login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    signup: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨",
    my_applications: "ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ",
    workshops: "ğŸ“˜ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„"
  },
  en: {
    page_title: "ğŸ’¼ Available Jobs",
    header_title: "ğŸ’¼ Career Building for JU Students",
    jobs_title: "ğŸ’¼ Available Jobs",
    loading: "â³ Loading jobs...",
    no_jobs: "ğŸš« No jobs available",
    apply: "ğŸ“„ Apply Now",
    contact: "Contact Us",
    about: "About Us",
    logout: "Logout",
    login: "Login",
    signup: "Create Account",
    my_applications: "ğŸ“„ My Applications",
    workshops: "ğŸ“˜ Workshops"
  }
};

let currentLang = "ar";

document.getElementById("langToggle").onclick = () => {
  currentLang = currentLang === "ar" ? "en" : "ar";
  document.documentElement.lang = currentLang;
  document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

  document.querySelectorAll("[data-text]").forEach(el => {
    el.textContent = translations[currentLang][el.dataset.text];
  });

  document.title = translations[currentLang].page_title;
  renderMenu();

  document.getElementById("langToggle").textContent =
    currentLang === "ar" ? "EN" : "AR";
};

/* ============================================
      ğŸ‘¤ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
============================================ */
const user = JSON.parse(localStorage.getItem("user"));
const menu = document.getElementById("menu");

function renderMenu() {
  if (user && user.user_type === "job_seeker") {
    menu.innerHTML = `
      <li class="username">ğŸ‘‹ ${user.full_name} â€” ${user.department || ""}</li>
      <li><a data-text="my_applications" href="student-applications.html">${translations[currentLang].my_applications}</a></li>
      <li><a data-text="workshops" href="workshops.html">${translations[currentLang].workshops}</a></li>
      <li><a data-text="about" href="about.html">${translations[currentLang].about}</a></li>
      <li><a data-text="contact" href="contact.html">${translations[currentLang].contact}</a></li>
      <li><button class="logout-btn" onclick="logout()" data-text="logout">${translations[currentLang].logout}</button></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a data-text="about" href="about.html">${translations[currentLang].about}</a></li>
      <li><a data-text="contact" href="contact.html">${translations[currentLang].contact}</a></li>
      <li><a href="login.html" data-text="login">${translations[currentLang].login}</a></li>
      <li><a href="signup.html" data-text="signup">${translations[currentLang].signup}</a></li>
    `;
  }
}
renderMenu();

function logout() {
  localStorage.removeItem("user");
  window.location.href = "login.html";
}

/* ============================================
      ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
============================================ */
async function fetchJobs() {
  const jobsList = document.getElementById("jobsList");

  try {
    const res = await fetch("/.netlify/functions/get-jobs");
    const data = await res.json();
    const jobs = data.jobs || [];

    if (!jobs.length) {
      jobsList.innerHTML = `<p style="text-align:center;color:#ccc;">${translations[currentLang].no_jobs}</p>`;
      return;
    }

    jobsList.innerHTML = "";

    jobs.forEach(job => {
      const canApply =
        !job.restrict_to_department ||
        (user && user.department === job.department);

      jobsList.innerHTML += `
        <div class="job-card">
          <div class="job-title">${job.job_title}</div>
          <div class="company-name">ğŸ¢ ${job.company_name}</div>
          <div>ğŸ“§ ${job.company_email || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</div>
          <div>ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…: ${job.department || "Ø¹Ø§Ù…"}</div>
          <div>â³ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…: ${job.application_deadline || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
          <div>ğŸ•’ ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©: ${job.interview_time || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
          <div>ğŸ“ ${job.location}</div>
          <div>ğŸ’° ${job.salary_range || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>

          ${
            job.restrict_to_department
              ? `<p style="color:red;font-weight:bold;">âš  Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù‚Ø³Ù…: ${job.department}</p>`
              : ""
          }

          ${
            canApply
              ? `<button class="apply-btn" onclick="applyJob(${job.id})">${translations[currentLang].apply}</button>`
              : `<button class="apply-btn disabled-btn">ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</button>`
          }
        </div>
      `;
    });

  } catch (err) {
    jobsList.innerHTML = `<p style="color:red;text-align:center;">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</p>`;
  }
}

function applyJob(id) {
  if (!user) return alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location.href = `apply.html?job_id=${id}`;
}

fetchJobs();
</script>

</body>
</html>
