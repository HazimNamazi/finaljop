<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-text="page_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { 
      font-family: 'Tajawal', sans-serif; 
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%); 
      color: white; margin: 0; padding: 0; 
    }
    header { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(10px); 
      display: flex; 
      justify-content: space-between; 
      padding: 14px 40px; 
      align-items: center;
    }

    .logo { 
      font-weight: 700; 
      color: #ffd369; 
      font-size: 20px;
    }

    .language-btn {
      cursor: pointer;
      background: none;
      border: 1px solid #ffd369;
      padding: 5px 10px;
      color: #ffd369;
      border-radius: 6px;
      font-size: 13px;
      margin-left: 15px;
      transition: 0.3s;
    }

    .jobs-container { 
      max-width: 900px; 
      margin: 60px auto; 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(8px); 
      padding: 30px; 
      border-radius: 16px; 
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    select {
      padding: 8px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }

    .job-card { 
      background: rgba(255,255,255,0.15); 
      padding: 20px; 
      border-radius: 12px; 
      margin-bottom: 20px; 
    }

    .job-title { font-size: 20px; font-weight: 700; }

    .company-name { color: #ffd369; font-weight: 600; }
  </style>
</head>

<body>

<header>
  <div class="logo" data-text="header_title">ğŸ’¼ Career Building for JU Students</div>

  <nav>
    <ul id="menu"></ul>
  </nav>

  <button class="language-btn" id="langToggle">EN</button>
</header>

<section class="jobs-container">

  <h2 data-text="jobs_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>

  <!-- ÙÙ„Ø§ØªØ± Ø§Ù„ØªØ±ØªÙŠØ¨ -->
  <div class="filters">
    <select id="sortDate" onchange="renderJobs()" style="flex:1">
      <option value="newest">ğŸ“… Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
      <option value="oldest">ğŸ“… Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
    </select>

    <select id="filterDept" onchange="renderJobs()" style="flex:1">
      <option value="">ğŸ“˜ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
      <option value="Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨">Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨</option>
      <option value="Ø§Ù„ØµØ­Ø©">Ø§Ù„ØµØ­Ø©</option>
      <option value="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
      <option value="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</option>
    </select>
  </div>

  <div id="jobsList" data-text="loading">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>

</section>

<script>

  /* ========================================================
      ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø© AR/EN
  ======================================================== */
  const translations = {
    ar: {
      page_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù",
      jobs_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
      loading: "â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...",
      no_jobs: "ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù",
      apply: "ğŸ“„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©",
      job_department: "ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…",
      interview_time: "ğŸ•’ ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©",
      deadline: "â³ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…",
      email: "ğŸ“§ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø´Ø±ÙƒØ©"
    },
    en: {
      page_title: "ğŸ’¼ Available Jobs",
      jobs_title: "ğŸ’¼ Available Jobs",
      loading: "â³ Loading jobs...",
      no_jobs: "ğŸš« No jobs available",
      apply: "ğŸ“„ Apply Now",
      job_department: "ğŸ“˜ Department",
      interview_time: "ğŸ•’ Interview Time",
      deadline: "â³ Application Deadline",
      email: "ğŸ“§ Company Email"
    }
  };

  let currentLang = "ar";
  const user = JSON.parse(localStorage.getItem("user"));
  const menu = document.getElementById("menu");

  document.getElementById("langToggle").onclick = () => {
    currentLang = currentLang === "ar" ? "en" : "ar";
    document.documentElement.lang = currentLang;
    document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

    document.querySelectorAll("[data-text]").forEach(el => {
      el.textContent = translations[currentLang][el.dataset.text];
    });

    document.title = translations[currentLang].page_title;
    renderJobs();
  };

  /* ========================================================
      Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  ======================================================== */
  function renderMenu() {
    if (user && user.user_type === "job_seeker") {
      menu.innerHTML = `
        <li>ğŸ‘‹ ${user.full_name} â€” ${user.department}</li>
        <li><a href="student-applications.html">ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
      `;
    } else {
      menu.innerHTML = `
        <li><a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></li>
        <li><a href="signup.html">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></li>
      `;
    }
  }
  renderMenu();

  /* ========================================================
      ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
  ======================================================== */
  let jobsData = [];

  async function fetchJobs() {
    try {
      const res = await fetch("/.netlify/functions/get-jobs");
      const data = await res.json();
      jobsData = data.jobs || [];
      renderJobs();
    } catch (err) {
      document.getElementById("jobsList").innerHTML =
        `<p style='color:red;text-align:center;'>âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</p>`;
    }
  }

  /* ========================================================
      ğŸ”¥ Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù + Ø§Ù„ÙØ±Ø² + Ø§Ù„ÙÙ„ØªØ±Ø©
  ======================================================== */
  function renderJobs() {
    const list = document.getElementById("jobsList");
    const selectedSort = document.getElementById("sortDate").value;
    const selectedDept = document.getElementById("filterDept").value;

    let jobs = [...jobsData];

    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
    if (selectedDept) {
      jobs = jobs.filter(j => j.department === selectedDept);
    }

    // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
    jobs.sort((a, b) => {
      const da = new Date(a.created_at);
      const db = new Date(b.created_at);
      return selectedSort === "newest" ? db - da : da - db;
    });

    if (!jobs.length) {
      list.innerHTML = `<p>${translations[currentLang].no_jobs}</p>`;
      return;
    }

    list.innerHTML = jobs
      .map(job => `
        <div class="job-card">
          <div class="job-title">${job.job_title}</div>
          <div class="company-name">ğŸ¢ ${job.company_name}</div>

          <p><strong>${translations[currentLang].email}:</strong> ${job.company_email || "â€”"}</p>
          <p><strong>${translations[currentLang].job_department}:</strong> ${job.department || "â€”"}</p>
          <p><strong>${translations[currentLang].deadline}:</strong> ${job.application_deadline || "â€”"}</p>
          <p><strong>${translations[currentLang].interview_time}:</strong> ${job.interview_time || "â€”"}</p>

          <p style="color:#eee;">${job.job_description}</p>

          <button onclick="applyJob(${job.id})">${translations[currentLang].apply}</button>
        </div>
      `)
      .join("");
  }

  function applyJob(id) {
    if (!user) return alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = `apply.html?job_id=${id}`;
  }

  fetchJobs();
</script>

</body>
</html>
