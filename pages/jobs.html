<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-text="page_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%);
      margin: 0;
      padding: 0;
      color: white;
    }

    header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 14px 35px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .logo {
      font-weight: bold;
      font-size: 20px;
      color: #ffd369;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      padding: 0;
      margin: 0;
      align-items: center;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: 600;
    }

    nav a:hover {
      color: #ffd369;
    }

    .language-btn {
      cursor: pointer;
      background: none;
      border: 1px solid #ffd369;
      padding: 4px 12px;
      color: #ffd369;
      border-radius: 6px;
      font-size: 12px;
      transition: 0.3s;
    }

    .language-btn:hover {
      background: #ffd369;
      color: #001f3f;
    }

    .logout-btn {
      background: #ff4f4f;
      color: white;
      font-weight: bold;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .jobs-container {
      max-width: 900px;
      margin: 70px auto;
      background: rgba(255,255,255,0.10);
      padding: 30px;
      border-radius: 16px;
    }

    .job-card {
      background: rgba(255,255,255,0.15);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .job-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #ffd369;
    }

    .company-email {
      color: #cde7ff;
      font-size: 14px;
    }

    .label-warning {
      background: #ffcccc;
      color: #b10000;
      padding: 6px;
      border-radius: 6px;
      margin-top: 10px;
      display: inline-block;
      font-size: 14px;
      font-weight: bold;
    }

    button.apply-btn {
      background: #007bff;
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      border: none;
      margin-top: 12px;
      cursor: pointer;
      transition: 0.2s;
    }

    button.apply-btn:hover {
      transform: scale(1.03);
      background: #005fcc;
    }

    html[dir="ltr"] nav ul {
      flex-direction: row-reverse;
    }
  </style>
</head>

<body>

<header>
  <div class="logo" data-text="header_title">ğŸ’¼ Career Building for JU Students</div>

  <nav>
    <ul id="menu"></ul>
  </nav>

  <button class="language-btn" id="langToggle">EN</button>
</header>

<section class="jobs-container">
  <h2 data-text="jobs_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="jobsList" data-text="loading">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>
</section>

<script>
/* ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø© */
const translations = {
  ar: {
    page_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
    header_title: "ğŸ’¼ Career Building for JU Students",
    jobs_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
    loading: "â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...",
    no_jobs: "ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù",
    apply: "ğŸ“„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©",
    my_applications: "Ø·Ù„Ø¨Ø§ØªÙŠ ğŸ“„",
    logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬"
  },
  en: {
    page_title: "ğŸ’¼ Available Jobs",
    header_title: "ğŸ’¼ Career Building for JU Students",
    jobs_title: "ğŸ’¼ Available Jobs",
    loading: "â³ Loading jobs...",
    no_jobs: "ğŸš« No jobs available",
    apply: "ğŸ“„ Apply Now",
    my_applications: "My Applications ğŸ“„",
    logout: "Logout"
  }
};

let currentLang = "ar";

/* ğŸ”„ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù„ØºØ© */
document.getElementById("langToggle").onclick = () => {
  currentLang = currentLang === "ar" ? "en" : "ar";
  document.documentElement.lang = currentLang;
  document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

  document.querySelectorAll("[data-text]").forEach(el => {
    el.textContent = translations[currentLang][el.dataset.text];
  });

  document.title = translations[currentLang].page_title;

  document.getElementById("langToggle").textContent =
    currentLang === "ar" ? "EN" : "AR";

  renderMenu();
  fetchJobs(); // ğŸ”¥ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
};

/* ğŸ‘¤ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
const user = JSON.parse(localStorage.getItem("user"));
const menu = document.getElementById("menu");

function renderMenu() {
  if (user && user.user_type === "job_seeker") {
    menu.innerHTML = `
      <li>ğŸ‘‹ ${user.full_name} â€“ ${user.department || ""}</li>
      <li><a href="student-applications.html" data-text="my_applications">${translations[currentLang].my_applications}</a></li>
      <li><button class="logout-btn" onclick="logout()" data-text="logout">${translations[currentLang].logout}</button></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="login.html">Login</a></li>
      <li><a href="signup.html">Signup</a></li>
    `;
  }
}

renderMenu();

function logout() {
  localStorage.removeItem("user");
  location.href = "login.html";
}

/* ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù */
async function fetchJobs() {
  const jobsList = document.getElementById("jobsList");

  try {
    const res = await fetch("/.netlify/functions/get-jobs");
    const data = await res.json();
    const jobs = data.jobs || [];

    if (!jobs.length) {
      jobsList.innerHTML = `<p>${translations[currentLang].no_jobs}</p>`;
      return;
    }

    jobsList.innerHTML = jobs.map(job => {
      const canApply = user && user.department === job.department;

      return `
        <div class="job-card">
          <div class="job-title">${job.job_title}</div>
          <div class="company-email">ğŸ“§ ${job.company_email || "-"}</div>
          <div>ğŸ¢ ${job.company_name || "-"}</div>
          <div>ğŸ“ ${job.location || "-"}</div>
          <div>ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…: ${job.department || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
          <div>ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨: ${job.salary_range || "-"}</div>

          ${
            user && !canApply
              ? `<div class="label-warning">âš ï¸ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù‚Ø³Ù…: ${job.department}</div>`
              : ""
          }

          ${
            user && canApply
              ? `<button class="apply-btn" onclick="applyJob(${job.id})">${translations[currentLang].apply}</button>`
              : ""
          }
        </div>
      `;
    }).join("");

  } catch (err) {
    jobsList.innerHTML = `<p style="color:red;">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</p>`;
  }
}

function applyJob(id) {
  if (!user) return alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ù‹Ø§");
  window.location.href = `apply.html?job_id=${id}`;
}

/* ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ */
fetchJobs();
</script>

</body>
</html>
