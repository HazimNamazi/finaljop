<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-text="page_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%);
      color: white;
      margin: 0;
      padding: 0;
    }

    header {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 35px;
      color: #ffd369;
    }

    .logo {
      font-weight: 700;
      font-size: 20px;
      color: #ffd369;
    }

    /* Ø²Ø± Ø§Ù„Ù„ØºØ© */
    .language-btn {
      cursor: pointer;
      background: rgba(255,255,255,0.15);
      border: none;
      padding: 6px 14px;
      color: #ffd369;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      transition: 0.2s ease;
      margin-right: 15px;
    }

    .language-btn:hover {
      background: rgba(255,255,255,0.28);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 18px;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    nav a {
      color: #fff;
      font-weight: 600;
      text-decoration: none;
    }

    nav a:hover {
      color: #ffd369;
    }

    .username {
      color: #ffd369;
      font-weight: bold;
    }

    .logout-btn {
      background: #ff4f4f;
      color: white;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      border: none;
      font-weight: bold;
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù */
    .jobs-container {
      max-width: 920px;
      margin: 60px auto;
      padding: 40px;
      border-radius: 20px;
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
    }

    .section-title {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 15px;
      text-align: center;
      color: #ffd369;
    }

    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ¸ÙŠÙØ© */
    .job-card {
      background: rgba(255,255,255,0.15);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .job-header {
      display: flex;
      justify-content: space-between;
      font-size: 20px;
      font-weight: 600;
      color: #fff;
    }

    .job-meta {
      margin-top: 7px;
      font-size: 15px;
      color: #e7e7e7;
      line-height: 1.7;
    }

    .apply-btn {
      margin-top: 10px;
      padding: 10px 16px;
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
      transition: 0.3s;
    }

    .apply-btn:hover {
      transform: scale(1.05);
    }

    .restricted {
      margin-top: 8px;
      background: #ffcfcf;
      padding: 5px 10px;
      border-radius: 8px;
      color: #a70000;
      font-weight: bold;
      font-size: 13px;
      display: inline-block;
    }
  </style>

</head>

<body>

<header>
  <div class="logo">ğŸ’¼ Career Building for JU Students</div>

  <nav>
    <ul id="menu"></ul>
  </nav>

  <button id="langToggle" class="language-btn">EN</button>
</header>

<section class="jobs-container">
  <h2 class="section-title" data-text="jobs_title">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="jobsList" data-text="loading">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>
</section>

<script>

  /* ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø© */
  const translations = {
    ar: {
      page_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù",
      jobs_title: "ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©",
      loading: "â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...",
      no_jobs: "ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ø­Ø§Ù„ÙŠØ§Ù‹",
      apply: "ğŸ“„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©",
      about: "Ù…Ù† Ù†Ø­Ù†",
      contact: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
      my_applications: "ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ",
      workshops: "ğŸ“˜ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„",
      logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",
      login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
      signup: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨",
    },
    en: {
      page_title: "ğŸ’¼ Available Jobs",
      jobs_title: "ğŸ’¼ Available Jobs",
      loading: "â³ Loading jobs...",
      no_jobs: "ğŸš« No jobs available",
      apply: "ğŸ“„ Apply Now",
      about: "About Us",
      contact: "Contact Us",
      my_applications: "ğŸ“„ My Applications",
      workshops: "ğŸ“˜ Workshops",
      logout: "Logout",
      login: "Login",
      signup: "Create Account",
    }
  };

  let currentLang = "ar";

  document.getElementById("langToggle").onclick = () => {
    currentLang = currentLang === "ar" ? "en" : "ar";
    document.documentElement.lang = currentLang;
    document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

    document.querySelectorAll("[data-text]").forEach(el => {
      el.textContent = translations[currentLang][el.dataset.text];
    });

    document.title = translations[currentLang].page_title;

    renderMenu();

    document.getElementById("langToggle").textContent =
      currentLang === "ar" ? "EN" : "AR";
  };

  /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
  const user = JSON.parse(localStorage.getItem("user"));
  const menu = document.getElementById("menu");

  function renderMenu() {
    if (user && user.user_type === "job_seeker") {
      menu.innerHTML = `
        <li class="username">ğŸ‘‹ ${user.full_name} â€” ${user.department || ""}</li>
        <li><a data-text="my_applications" href="student-applications.html">${translations[currentLang].my_applications}</a></li>
        <li><a data-text="workshops" href="workshops.html">${translations[currentLang].workshops}</a></li>
        <li><a data-text="about" href="about.html">${translations[currentLang].about}</a></li>
        <li><a data-text="contact" href="contact.html">${translations[currentLang].contact}</a></li>
        <li><button class="logout-btn" onclick="logout()" data-text="logout">${translations[currentLang].logout}</button></li>
      `;
    } else {
      menu.innerHTML = `
        <li><a data-text="about" href="about.html">${translations[currentLang].about}</a></li>
        <li><a data-text="contact" href="contact.html">${translations[currentLang].contact}</a></li>
        <li><a data-text="login" href="login.html">${translations[currentLang].login}</a></li>
        <li><a data-text="signup" href="signup.html">${translations[currentLang].signup}</a></li>
      `;
    }
  }

  renderMenu();

  function logout() {
    localStorage.removeItem("user");
    window.location.href = "login.html";
  }

  /* Ø¬Ù„Ø¨ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù */
  async function fetchJobs() {
    const jobsList = document.getElementById("jobsList");

    try {
      const res = await fetch("/.netlify/functions/get-jobs");
      const data = await res.json();
      const jobs = data.jobs || [];

      if (!jobs.length) {
        jobsList.innerHTML = `<p style="text-align:center;">${translations[currentLang].no_jobs}</p>`;
        return;
      }

      jobsList.innerHTML = jobs.map(job => {
        const deadline = job.application_deadline
          ? new Date(job.application_deadline).toLocaleString("ar-SA")
          : " â€” ";

        const interview = job.interview_time
          ? new Date(job.interview_time).toLocaleString("ar-SA")
          : " â€” ";

        const restricted =
          job.restrict_to_department && user && user.department !== job.department
            ? `<div class="restricted">âš ï¸ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù‚Ø³Ù…: ${job.department}</div>`
            : "";

        const allowApply =
          !job.restrict_to_department ||
          (user && user.department === job.department);

        return `
          <div class="job-card">
            <div class="job-header">
              <span>${job.job_title}</span>
              <span>ğŸ¢ ${job.company_name}</span>
            </div>

            <div class="job-meta">
              ğŸ“§ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø´Ø±ÙƒØ©: ${job.company_email || "â€”"}<br>
              ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…: ${job.department || "Ø¹Ø§Ù…"}<br>
              â³ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…: ${deadline}<br>
              ğŸ•’ ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©: ${interview}<br>
              ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${job.location || "â€”"}<br>
              ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨: ${job.salary_range || "â€”"}
            </div>

            ${restricted}

            ${
              user && allowApply
                ? `<button class="apply-btn" onclick="applyJob(${job.id})">${translations[currentLang].apply}</button>`
                : ""
            }

          </div>
        `;
      }).join("");

    } catch (err) {
      jobsList.innerHTML = `<p style="color:red;text-align:center;">âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</p>`;
    }
  }

  function applyJob(id) {
    if (!user) return alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = `apply.html?job_id=${id}`;
  }

  fetchJobs();

</script>

</body>
</html>
