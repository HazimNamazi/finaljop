<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { 
      font-family: 'Tajawal', sans-serif; 
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%); 
      color: white; margin: 0; padding: 0; 
    }
    header { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(10px); 
      display: flex; 
      justify-content: space-between; 
      padding: 14px 40px; 
      align-items: center;
    }
    .logo { 
      font-weight: 700; 
      color: #ffd369; 
      font-size: 20px; 
      display: flex; 
      gap: 8px; 
    }
    nav ul { 
      list-style: none; 
      display: flex; 
      gap: 20px; 
      align-items: center;
    }
    nav a { 
      color: #fff; 
      font-weight: 600; 
      text-decoration: none; 
    }
    .username { 
      color: #ffd369; 
      font-weight: bold;
    }

    .logout-btn {
      background: #ff4f4f;
      color: white;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      border: none;
      font-weight: bold;
    }

    .jobs-container { 
      max-width: 900px; 
      margin: 60px auto; 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(8px); 
      padding: 30px; 
      border-radius: 16px; 
    }

    .job-card, .workshop-card { 
      background: rgba(255,255,255,0.15); 
      padding: 20px; 
      border-radius: 12px; 
      margin-bottom: 20px; 
    }
    .job-title { font-size: 20px; font-weight: 700; color: #fff; }
    .company-name { color: #ffd369; font-weight: 600; }

    .workshop-title { font-size:18px; font-weight:700; color:#aaffc4; }
    .attended-tag { background:#d9ffe5; color:#28a745; padding:5px 10px; border-radius:8px; }

    button { 
      background: linear-gradient(135deg, #007bff, #0056b3); 
      border: none; 
      padding: 10px 16px; 
      border-radius: 8px; 
      color: white; 
      cursor: pointer; 
      font-size: 15px; 
    }
    button:hover { transform: scale(1.05); }
  </style>
</head>

<body>

<header>
  <div class="logo">ğŸ’¼ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</div>

  <nav>
    <ul id="menu"></ul>
  </nav>
</header>

<section class="jobs-container">

  <!-- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù -->
  <h2>ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="jobsList">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</div>

  <hr style="margin:40px 0;">

  <!-- Ø§Ù„ÙˆØ±Ø´ -->
  <h2>ğŸ“˜ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
  <div id="workshopsList">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´...</div>

</section>

<script>

  /* ===========================
     ğŸ”¥ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­Ø³Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  ============================ */
  const user = JSON.parse(localStorage.getItem("user"));
  const menu = document.getElementById("menu");

  if (user && user.user_type === "job_seeker") {
    menu.innerHTML = `
      <li class="username">ğŸ‘‹ ${user.full_name}</li>
      <li><a href="student-applications.html">ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
      <li><button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="jobs.html" style="color:#ffd369;">Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a></li>
      <li><a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></li>
      <li><a href="signup.html">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></li>
    `;
  }

  function logout() {
    localStorage.removeItem("user");
    window.location.href = "login.html";
  }

  /* ===========================
      ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
  ============================ */
  async function fetchJobs() {
    const jobsList = document.getElementById("jobsList");

    try {
      const res = await fetch("/.netlify/functions/get-jobs");
      const data = await res.json();
      const jobs = data.jobs || [];

      if (!jobs.length) {
        jobsList.innerHTML = "<p style='text-align:center;color:#ccc;'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù</p>";
        return;
      }

      jobsList.innerHTML = jobs.map(job => `
        <div class="job-card">
          <div class="job-title">${job.job_title}</div>
          <div class="company-name">ğŸ¢ ${job.company_name}</div>
          <div>ğŸ“ ${job.location}</div>
          <div>ğŸ’° ${job.salary_range || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
          <p style="color:#eee;">${job.job_description}</p>
          <button onclick="applyJob(${job.id})">ğŸ“„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙØ©</button>
        </div>
      `).join("");

    } catch {
      jobsList.innerHTML = "<p style='text-align:center;color:red;'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</p>";
    }
  }

  function applyJob(id) {
    if (!user) return alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = `apply.html?job_id=${id}`;
  }

  /* ===========================
      ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´
  ============================ */
  async function fetchWorkshops() {
    const box = document.getElementById("workshopsList");

    try {
      const res = await fetch("/.netlify/functions/get-workshops");
      const workshops = await res.json();

      if (!workshops.length) {
        box.innerHTML = "<p style='text-align:center;color:#ccc;'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ±Ø´ Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
        return;
      }

      box.innerHTML = "";

      for (let w of workshops) {
        let attended = false;

        if (user) {
          const att = await fetch(
            `/.netlify/functions/check-workshop-attendance?student_id=${user.id}&workshop_id=${w.id}`
          );
          attended = (await att.json()).attended;
        }

        box.innerHTML += `
          <div class="workshop-card">
            <div class="workshop-title">ğŸ“˜ ${w.title}</div>
            <div>ğŸ“… ${w.date} â€“ â° ${w.time}</div>
            <div>ğŸ“ ${w.location || "Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†"}</div>

            ${w.link ? `<a href="${w.link}" target="_blank" style="color:#aafff3;">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ±Ø´Ø©</a>` : ""}

            <div style="margin-top:10px;">
              ${
                !user ? 
                  `<p style="color:#ffd369;">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</p>` :
                attended ?
                  `<span class="attended-tag">âœ”ï¸ Ø­Ø¶Ø±Øª Ø§Ù„ÙˆØ±Ø´Ø©</span>` :
                  `<button onclick="attendWorkshop(${w.id})">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>`
              }
            </div>
          </div>
        `;
      }

    } catch {
      box.innerHTML = "<p style='text-align:center;color:red;'>âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´</p>";
    }
  }

  async function attendWorkshop(id) {
    await fetch("/.netlify/functions/attend-workshop", {
      method: "POST",
      body: JSON.stringify({ student_id: user.id, workshop_id: id })
    });

    alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„ÙˆØ±Ø´Ø©");
    fetchWorkshops();
  }

  /* CALL FUNCTIONS */
  fetchJobs();
  fetchWorkshops();

</script>

</body>
</html>
