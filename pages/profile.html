<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }

    .profile-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 40px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 25px rgba(0,0,0,0.4);
      width: 400px;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 { color: #ffd369; margin-bottom: 15px; }
    p { font-size: 16px; margin-bottom: 10px; color: #eee; }

    .btn-back {
      margin-top: 20px;
      padding: 10px 20px;
      background: linear-gradient(135deg,#007bff,#0056b3);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-back:hover { transform: scale(1.05); background: linear-gradient(135deg,#0056b3,#004494); }

    .logout-btn {
      background: #dc3545;
      border: none;
      color: #fff;
      padding: 10px 18px;
      border-radius: 8px;
      margin-top: 15px;
      cursor: pointer;
      font-weight: bold;
    }

    .logout-btn:hover { background: #b02a37; transform: scale(1.05); }
  </style>
</head>

<body>
  <div class="profile-card">
    <h2>ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
    <p><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</strong> <span id="fullName"></span></p>
    <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> <span id="email"></span></p>
    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="userType"></span></p>
    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span id="status"></span></p>

    <button class="btn-back" onclick="window.location.href='jobs.html'">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ¸Ø§Ø¦Ù</button>
    <button class="logout-btn" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>   <hr style="margin:20px 0; border-color: rgba(255,255,255,0.2);">

    <h3 style="margin-bottom:10px;">ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</h3>
    <div id="applicationsList" style="text-align:right; max-height:250px; overflow-y:auto;"></div>
    
 </div>

 <script>
  const userData = JSON.parse(localStorage.getItem("user"));

  if (!userData) {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯!");
    window.location.href = "login.html";
  } else {
    document.getElementById("fullName").textContent = userData.full_name || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("email").textContent = userData.email || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("userType").textContent = 
      userData.user_type === "company" ? "Ø´Ø±ÙƒØ© ğŸ¢" :
      userData.user_type === "job_seeker" ? "Ø·Ø§Ù„Ø¨ ğŸ‘¨â€ğŸ“" : "Ø£Ø¯Ù…Ù† ğŸ§‘â€ğŸ’»";
    document.getElementById("status").textContent = userData.status || "Ù†Ø´Ø· âœ…";
  }

  async function loadMyApplications() {
    if (!userData || (userData.user_type !== "job_seeker" && userData.user_type !== "student")) {
      document.getElementById("applicationsList").innerHTML = "<p>âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø·Ù„Ø§Ø¨ ÙÙ‚Ø·.</p>";
      return;
    }

    try {
      const res = await fetch(`/.netlify/functions/get-student-applications?student_id=${userData.id}`);
      const apps = await res.json();

      const container = document.getElementById("applicationsList");

      if (!apps.length) {
        container.innerHTML = "<p>ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
        return;
      }

      container.innerHTML = apps.map(a => `
        <div style="background:rgba(0,0,0,0.25); padding:8px 10px; border-radius:8px; margin-bottom:8px; font-size:14px;">
          <div><strong>Ø§Ù„ÙˆØ¸ÙŠÙØ©:</strong> ${a.job_title}</div>
          <div><strong>Ø§Ù„Ø´Ø±ÙƒØ©:</strong> ${a.company_name}</div>
          <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${a.status}</div>
          <div style="font-size:12px; color:#ccc;">ğŸ“… ${new Date(a.created_at).toLocaleDateString()}</div>
        </div>
      `).join("");
    } catch (err) {
      console.error(err);
      document.getElementById("applicationsList").innerHTML = "<p>âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</p>";
    }
  }

  loadMyApplications();

  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("user");
    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‘‹");
    window.location.href = "login.html";
  });
</script>

</body>
</html>
