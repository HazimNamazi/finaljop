<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“˜ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„ - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family:'Tajawal', sans-serif;
      background: radial-gradient(circle at top right, #0a84ff, #001f3f 70%);
      margin:0;
      padding:0;
      color:white;
    }

    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    header {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 14px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .logo {
      font-size:22px;
      font-weight:700;
      color:#ffd369;
    }

    nav ul {
      list-style:none;
      display:flex;
      gap:25px;
      padding:0;
      margin:0;
    }

    nav a {
      color:white;
      font-weight:600;
      text-decoration:none;
    }

    nav a:hover {
      text-decoration:underline;
    }

    .logout-btn {
      background:#ff4f4f;
      color:white;
      padding:6px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ±Ø´ */
    .workshops-container {
      max-width:900px;
      margin:50px auto;
      background:rgba(255,255,255,0.1);
      padding:30px;
      border-radius:16px;
      backdrop-filter: blur(8px);
    }

    h2 {
      margin-bottom:25px;
      color:#ffd369;
      font-size:24px;
    }

    .workshop-card {
      background:rgba(255,255,255,0.15);
      padding:20px;
      border-radius:12px;
      margin-bottom:20px;
      color:white;
    }

    .workshop-title {
      font-size:20px;
      font-weight:700;
      color:#aaffc4;
    }

    .attended-tag {
      background:#d9ffe5;
      color:#28a745;
      padding:6px 12px;
      border-radius:8px;
      display:inline-block;
      margin-top:10px;
      font-weight:700;
    }

    button {
      background:linear-gradient(135deg, #007bff, #0056b3);
      border:none;
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      color:white;
      margin-top:10px;
    }

    button:hover {
      transform:scale(1.05);
    }

    a.link {
      color:#aafff3;
      font-weight:bold;
      text-decoration:none;
    }
  </style>
</head>

<body>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
<header>
  <div class="logo">ğŸ“˜ ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„</div>

  <nav>
    <ul id="menu"></ul>
  </nav>
</header>

<!-- ØµÙØ­Ø© Ø§Ù„ÙˆØ±Ø´ -->
<section class="workshops-container">
  <h2>ğŸ“˜ Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>

  <div id="workshopsList">â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´...</div>
</section>

<script>
  /* ===========================
     Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­Ø³Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  ============================ */
  const user = JSON.parse(localStorage.getItem("user"));
  const menu = document.getElementById("menu");

  if (user) {
    menu.innerHTML = `
      <li><a href="jobs.html">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a></li>
      <li><a href="student-applications.html">ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
      <li><button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="jobs.html">ğŸ’¼ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</a></li>
      <li><a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></li>
      <li><a href="signup.html">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></li>
    `;
  }

  function logout() {
    localStorage.removeItem("user");
    window.location.href = "login.html";
  }

  /* ===========================
     ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´
  ============================ */
  async function fetchWorkshops() {
    const box = document.getElementById("workshopsList");

    try {
      const res = await fetch("/.netlify/functions/get-workshops");
      const workshops = await res.json();

      if (!workshops.length) {
        box.innerHTML = "<p style='text-align:center;color:#ccc;'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ±Ø´ Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
        return;
      }

      box.innerHTML = "";

      for (let w of workshops) {
        let attended = false;

        if (user) {
          const att = await fetch(
            `/.netlify/functions/check-workshop-attendance?student_id=${user.id}&workshop_id=${w.id}`
          );
          attended = (await att.json()).attended;
        }

        box.innerHTML += `
          <div class="workshop-card">
            <div class="workshop-title">ğŸ“˜ ${w.title}</div>
            <div>ğŸ“… ${w.date} â€“ â° ${w.time}</div>
            <div>ğŸ“ ${w.location || "Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†"}</div>

            ${w.link ? `<a class="link" href="${w.link}" target="_blank">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ±Ø´Ø©</a>` : ""}

            <div style="margin-top:10px;">
              ${
                !user 
                  ? `<p style="color:#ffd369;">âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙˆØ±Ø´Ø©</p>`
                  : attended
                    ? `<span class="attended-tag">âœ”ï¸ Ø­Ø¶Ø±Øª Ø§Ù„ÙˆØ±Ø´Ø©</span>`
                    : `<button onclick="attendWorkshop(${w.id})">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>`
              }
            </div>
          </div>
        `;
      }

    } catch {
      box.innerHTML = "<p style='text-align:center;color:red;'>âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´</p>";
    }
  }

  async function attendWorkshop(id) {
    await fetch("/.netlify/functions/attend-workshop", {
      method:"POST",
      body: JSON.stringify({ student_id: user.id, workshop_id:id })
    });

    alert("âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„ÙˆØ±Ø´Ø©");
    fetchWorkshops();
  }

  fetchWorkshops();
</script>

</body>
</html>
