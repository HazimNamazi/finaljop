<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“„ Ø·Ù„Ø¨Ø§ØªÙŠ - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: #eef1f5;
      font-family: 'Tajawal';
      margin: 0;
      padding: 0;
    }

    header {
      background: #007bff;
      color: white;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 18px;
    }

    .logout-btn {
      background: #dc3545;
      padding: 8px 15px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      border: none;
      font-size: 14px;
    }

    .main-container {
      padding: 25px;
      max-width: 900px;
      margin: auto;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 18px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .status {
      font-weight: bold;
      margin-top: 8px;
    }

    .btn-cv {
      background: #6c63ff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }

    .btn-cv:hover {
      transform: scale(1.05);
    }

  </style>
</head>

<body>

<header>
  <div id="studentName">Ø§Ù„Ø·Ø§Ù„Ø¨</div>
  <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</header>

<div class="main-container">
  <h2>ğŸ“„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§</h2>
  <div id="applicationsList">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script>
  /* =============================
       Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨
  ============================== */
  const user = JSON.parse(localStorage.getItem("user"));

  if (!user || user.user_type !== "job_seeker") {
    alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ·Ø§Ù„Ø¨.");
    window.location.href = "/pages/login.html";
  }

  document.getElementById("studentName").innerText = user.full_name;


  /* =============================
       ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  ============================== */
  function logout() {
    localStorage.removeItem("user");
    location.href = "login.html";
  }


  /* =============================
        ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
  ============================== */
  async function loadStudentApps() {
    const res = await fetch(`/.netlify/functions/get-student-applications?student_id=${user.id}`);
    const data = await res.json();

    const list = document.getElementById("applicationsList");
    list.innerHTML = "";

    if (!data.success || !data.applications.length) {
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
      return;
    }

    data.applications.forEach(app => {
      list.innerHTML += `
        <div class="card">
          <h3>ğŸ’¼ ${app.job_title}</h3>

          <p><strong>Ø§Ù„Ø´Ø±ÙƒØ©:</strong> ${app.company_name}</p>
          <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${app.created_at?.split("T")[0] || "â€”"}</p>

          <p class="status">
            <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong>
            <span style="color:${getStatusColor(app.status)};">${app.status}</span>
          </p>

          ${app.cv_url 
            ? `<button class="btn-cv" onclick="window.open('${app.cv_url}', '_blank')">ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</button>`
            : "<p style='color:red;'>âŒ Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©</p>"
          }
        </div>
      `;
    });
  }

  /* Ù„ÙˆÙ† Ø§Ù„Ø­Ø§Ù„Ø© */
  function getStatusColor(status) {
    switch (status) {
      case "Ù…Ù‚Ø¨ÙˆÙ„": return "green";
      case "Ù…Ø±ÙÙˆØ¶": return "red";
      case "Ù…Ù‚Ø§Ø¨Ù„Ø©": return "#007bff";
      default: return "black";
    }
  }

  loadStudentApps();

</script>

</body>
</html>
