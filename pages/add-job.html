<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</title>

  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(180deg, #f8faff 0%, #ffffff 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex: 1;
      max-width: 650px;
      margin: 80px auto;
      background: #fff;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #007bff;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    input, textarea, select {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
      outline: none;
      transition: 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }

    button {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: #fff;
      padding: 12px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: linear-gradient(135deg, #0056b3, #004080);
      transform: scale(1.02);
    }

    .success-message, .error-message {
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      display: none;
    }

    .success-message {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error-message {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .back-btn {
      display: inline-block;
      margin-top: 20px;
      text-align: center;
      background: #6c757d;
      color: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      text-decoration: none;
      transition: 0.3s;
    }

    .back-btn:hover {
      background: #5a6268;
    }
  </style>
</head>

<body>

  <div class="container">
    <h2>ğŸ§© Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>

    <form id="jobForm">
      <input type="text" name="job_title" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" required />
      <input type="text" name="company_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©" required />
      <input type="text" name="location" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø¬Ø¯Ø©)" />
      <input type="text" name="salary_range" placeholder="Ø§Ù„Ø±Ø§ØªØ¨ (Ù…Ø«Ù„Ø§Ù‹: 8000 - 12000 Ø±ÙŠØ§Ù„)" />
      
      <select name="job_type" required>
        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©</option>
        <option value="Full-time">Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„</option>
        <option value="Part-time">Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ</option>
        <option value="Remote">Ø¹Ù† Ø¨ÙØ¹Ø¯</option>
        <option value="Internship">ØªØ¯Ø±ÙŠØ¨</option>
      </select>

      <textarea name="job_description" placeholder="Ø§Ù„ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø§Ù„ÙƒØ§Ù…Ù„..." rows="5" required></textarea>

      <button type="submit">ğŸ“¤ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¸ÙŠÙØ©</button>

      <div class="success-message" id="successMsg">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø¬Ø§Ø­!</div>
      <div class="error-message" id="errorMsg">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©.</div>
    </form>

    <a href="company-dashboard.html" class="back-btn"><i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </div>

  <script>
    // ğŸ“Œ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    const user = JSON.parse(localStorage.getItem("user") || "null");

    if (!user || user.user_type !== "company") {
      alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ´Ø±ÙƒØ© Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ©");
      window.location.href = "login.html";
    }

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    const companyInput = document.querySelector('input[name="company_name"]');
    companyInput.value = user.full_name || user.username;

    // ğŸ“Œ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙØ©
    document.getElementById("jobForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = Object.fromEntries(new FormData(e.target));
      formData.company_id = user.id; // âœ” Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹

      const successMsg = document.getElementById("successMsg");
      const errorMsg = document.getElementById("errorMsg");

      successMsg.style.display = "none";
      errorMsg.style.display = "none";

      try {
        const res = await fetch("/.netlify/functions/add-job", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });

        const result = await res.json();

        if (res.ok) {
          successMsg.style.display = "block";
          e.target.reset();
        } else {
          errorMsg.textContent = "âŒ " + (result.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.");
          errorMsg.style.display = "block";
        }
      } catch (err) {
        errorMsg.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
        errorMsg.style.display = "block";
      }
    });
  </script>

</body>
</html>
